import{a as j}from"./chunk-IBBY3ZPZ.js";import{a as F}from"./chunk-EOLJ7M3P.js";import{a as A}from"./chunk-CLZWIFWZ.js";import{a as z}from"./chunk-TMF6H46K.js";import{a as R}from"./chunk-4PCVNBAZ.js";import{B as m,C as h,G as p,J as k,K as c,L as n,M as e,N as M,O as b,P as f,Q as l,R as O,S as x,T as i,U as d,V as u,aa as C,ea as P,ha as y,ia as S,ka as w,ma as I,o as _,oa as E,p as v,pa as D,sa as T,wa as L,y as r}from"./chunk-WLOU5G26.js";var N=a=>["/customers",a,"edit"],B=a=>({customerId:a}),$=a=>["/tickets",a];function q(a,o){a&1&&M(0,"app-loading-spinner",5)}function U(a,o){a&1&&(n(0,"div",6)(1,"h2"),i(2,"Customer Not Found"),e(),n(3,"p"),i(4,"The customer you're looking for doesn't exist."),e(),n(5,"a",7),i(6,"\u2190 Back to Customers"),e()())}function Y(a,o){if(a&1){let t=b();n(0,"div",37)(1,"a",38),i(2," Edit Customer "),e(),n(3,"button",39),f("click",function(){_(t);let g=l(2);return v(g.showDeleteConfirm=!0)}),i(4," Delete Customer "),e()()}if(a&2){let t=l(2);r(),c("routerLink",C(1,N,t.customer.id))}}function G(a,o){if(a&1){let t=b();n(0,"app-alert",40),f("close",function(){_(t);let g=l(2);return v(g.errorMessage="")}),e()}if(a&2){let t=l(2);c("message",t.errorMessage)}}function J(a,o){if(a&1&&(n(0,"a",41),i(1," View All \u2192 "),e()),a&2){let t=l(2);c("queryParams",C(1,B,t.customer.id))}}function Q(a,o){if(a&1&&(n(0,"tr")(1,"td",44)(2,"a",45),i(3),e()(),n(4,"td",46),i(5),e(),n(6,"td")(7,"span",47),i(8),e()(),n(9,"td")(10,"span",48),i(11),e()(),n(12,"td",49),i(13),e()()),a&2){let t=o.$implicit,s=l(3);k("data-testid","customer-ticket-row-"+t.id),r(2),c("routerLink",C(11,$,t.id)),r(),d(t.id),r(2),d(t.title),r(2),x(s.getStatusClass(t.status)),r(),u(" ",t.status," "),r(2),x(s.getPriorityClass(t.priority)),r(),u(" ",t.priority," "),r(2),d(s.formatDate(t.updatedAt))}}function W(a,o){if(a&1&&(n(0,"table",42)(1,"thead")(2,"tr")(3,"th"),i(4,"ID"),e(),n(5,"th"),i(6,"Title"),e(),n(7,"th"),i(8,"Status"),e(),n(9,"th"),i(10,"Priority"),e(),n(11,"th"),i(12,"Updated"),e()()(),n(13,"tbody"),p(14,Q,14,13,"tr",43),e()()),a&2){let t=l(2);r(14),c("ngForOf",t.tickets.slice(0,10))}}function H(a,o){a&1&&(n(0,"div",50)(1,"p"),i(2,"No tickets associated with this customer."),e()())}function K(a,o){if(a&1&&(n(0,"div",8)(1,"header",9)(2,"div",10)(3,"a",11),i(4,"\u2190 Back to Customers"),e(),n(5,"div",12)(6,"h1",13),i(7),e(),n(8,"span",14),i(9),e()()(),p(10,Y,5,3,"div",15),e(),p(11,G,1,1,"app-alert",16),n(12,"div",17)(13,"section",18)(14,"div",19)(15,"h2"),i(16,"Customer Information"),e(),n(17,"div",20)(18,"div",21)(19,"span",22),i(20,"Company"),e(),n(21,"span",23),i(22),e()(),n(23,"div",21)(24,"span",22),i(25,"Email"),e(),n(26,"span",24),i(27),e()(),n(28,"div",21)(29,"span",22),i(30,"SLA Level"),e(),n(31,"span",25),i(32),e()(),n(33,"div",21)(34,"span",22),i(35,"Status"),e(),n(36,"span",26),i(37),e()()()(),n(38,"div",19)(39,"div",27)(40,"h2"),i(41),e(),p(42,J,2,3,"a",28),e(),n(43,"div",29),p(44,W,15,1,"table",30)(45,H,3,0,"div",31),e()()(),n(46,"aside",32)(47,"div",33)(48,"h2"),i(49,"Quick Stats"),e(),n(50,"div",34)(51,"span",35),i(52),e(),n(53,"span",36),i(54,"Total Tickets"),e()(),n(55,"div",34)(56,"span",35),i(57),e(),n(58,"span",36),i(59,"Open Tickets"),e()(),n(60,"div",34)(61,"span",35),i(62),e(),n(63,"span",36),i(64,"Resolved Tickets"),e()()()()()()),a&2){let t=l();r(7),d(t.customer.name),r(2),d(t.customer.id),r(),c("ngIf",t.authService.isAdmin),r(),c("ngIf",t.errorMessage),r(11),d(t.customer.company),r(5),d(t.customer.email),r(4),x(t.customer.slaLevel.toLowerCase()),r(),u(" ",t.customer.slaLevel," "),r(4),O("active",t.customer.isActive)("inactive",!t.customer.isActive),r(),u(" ",t.customer.isActive?"Active":"Inactive"," "),r(4),u("Associated Tickets (",t.tickets.length,")"),r(),c("ngIf",t.tickets.length>0),r(2),c("ngIf",t.tickets.length>0),r(),c("ngIf",t.tickets.length===0),r(7),d(t.tickets.length),r(5),d(t.getOpenTicketsCount()),r(5),d(t.getResolvedTicketsCount())}}var V=class a{constructor(o,t,s,g,X,Z){this.route=o;this.router=t;this.customerService=s;this.ticketService=g;this.authService=X;this.cdr=Z}customer=null;tickets=[];loading=!0;showDeleteConfirm=!1;errorMessage="";ngOnInit(){let o=this.route.snapshot.paramMap.get("id");o&&this.loadCustomer(o)}loadCustomer(o){this.loading=!0,this.customerService.getCustomerById(o).subscribe({next:t=>{this.customer=t,t?this.ticketService.getTicketsByCustomerId(t.id).subscribe({next:s=>{this.tickets=s,this.loading=!1,this.cdr.detectChanges()},error:()=>{this.loading=!1,this.cdr.detectChanges()}}):(this.loading=!1,this.cdr.detectChanges())},error:t=>{console.error("Failed to load customer:",t),this.loading=!1,this.cdr.detectChanges()}})}deleteCustomer(){this.showDeleteConfirm=!1,this.customerService.deleteCustomer(this.customer.id).subscribe({next:()=>{this.router.navigate(["/customers"])},error:o=>{this.errorMessage=o.message||"Failed to delete customer",this.cdr.detectChanges()}})}getDeleteMessage(){let o=this.tickets.length;return o>0?`Warning: This customer has ${o} associated ticket(s). Are you sure you want to delete "${this.customer?.name}"? This action cannot be undone.`:`Are you sure you want to delete "${this.customer?.name}"? This action cannot be undone.`}getOpenTicketsCount(){return this.tickets.filter(o=>o.status==="Open").length}getResolvedTicketsCount(){return this.tickets.filter(o=>o.status==="Resolved"||o.status==="Closed").length}getStatusClass(o){return o.toLowerCase().replace(" ","-")}getPriorityClass(o){return o.toLowerCase()}formatDate(o){return new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric"})}static \u0275fac=function(t){return new(t||a)(m(I),m(E),m(R),m(A),m(L),m(P))};static \u0275cmp=h({type:a,selectors:[["app-customer-detail"]],decls:5,vars:5,consts:[["data-testid","customer-detail-page",1,"customer-detail-page"],["message","Loading customer...",4,"ngIf"],["class","not-found","data-testid","customer-not-found",4,"ngIf"],["class","customer-content",4,"ngIf"],["title","Delete Customer","confirmText","Delete",3,"confirm","cancel","visible","message"],["message","Loading customer..."],["data-testid","customer-not-found",1,"not-found"],["routerLink","/customers",1,"btn-secondary"],[1,"customer-content"],[1,"page-header"],[1,"header-left"],["routerLink","/customers",1,"back-link"],[1,"title-row"],["data-testid","customer-detail-name"],["data-testid","customer-detail-id",1,"customer-id"],["class","header-actions",4,"ngIf"],["type","error",3,"message","close",4,"ngIf"],[1,"detail-grid"],[1,"main-section"],[1,"card"],[1,"info-grid"],[1,"info-item"],[1,"label"],["data-testid","customer-company",1,"value"],["data-testid","customer-email",1,"value"],["data-testid","customer-sla",1,"sla-badge"],["data-testid","customer-status",1,"status-badge"],[1,"section-header"],["routerLink","/tickets","class","view-all","data-testid","view-customer-tickets",3,"queryParams",4,"ngIf"],["data-testid","customer-tickets-list",1,"tickets-list"],["class","tickets-table",4,"ngIf"],["class","no-tickets","data-testid","no-customer-tickets",4,"ngIf"],[1,"sidebar"],[1,"card","stats-card"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],[1,"header-actions"],["data-testid","edit-customer-button",1,"btn-secondary",3,"routerLink"],["data-testid","delete-customer-button",1,"btn-danger",3,"click"],["type","error",3,"close","message"],["routerLink","/tickets","data-testid","view-customer-tickets",1,"view-all",3,"queryParams"],[1,"tickets-table"],[4,"ngFor","ngForOf"],[1,"ticket-id"],[3,"routerLink"],[1,"ticket-title"],[1,"status-badge","ticket-status"],[1,"priority-badge"],[1,"ticket-date"],["data-testid","no-customer-tickets",1,"no-tickets"]],template:function(t,s){t&1&&(n(0,"div",0),p(1,q,1,0,"app-loading-spinner",1)(2,U,7,0,"div",2)(3,K,65,21,"div",3),n(4,"app-confirm-dialog",4),f("confirm",function(){return s.deleteCustomer()})("cancel",function(){return s.showDeleteConfirm=!1}),e()()),t&2&&(r(),c("ngIf",s.loading),r(),c("ngIf",!s.loading&&!s.customer),r(),c("ngIf",!s.loading&&s.customer),r(),c("visible",s.showDeleteConfirm)("message",s.getDeleteMessage()))},dependencies:[w,y,S,T,D,z,j,F],styles:[".customer-detail-page[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.not-found[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000f}.not-found[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#1a1a2e;margin:0 0 12px}.not-found[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin:0 0 24px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.back-link[_ngcontent-%COMP%]{color:#666;text-decoration:none;font-size:14px;display:inline-block;margin-bottom:8px}.back-link[_ngcontent-%COMP%]:hover{color:#0f3460}.title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.title-row[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Playfair Display,Georgia,serif;font-size:28px;color:#1a1a2e;margin:0}.customer-id[_ngcontent-%COMP%]{font-family:Monaco,Consolas,monospace;font-size:14px;color:#666;background:#f0f0f0;padding:4px 12px;border-radius:20px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-secondary[_ngcontent-%COMP%]{background:#f0f0f0;color:#333;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;text-decoration:none;display:inline-block;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e0e0e0}.btn-danger[_ngcontent-%COMP%]{background:#e74c3c;color:#fff;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;transition:all .2s ease}.btn-danger[_ngcontent-%COMP%]:hover{background:#c0392b}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 280px;gap:24px}.card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #0000000f;margin-bottom:20px}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;color:#1a1a2e;margin:0 0 16px;padding-bottom:12px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;padding:0;border:none}.view-all[_ngcontent-%COMP%]{color:#0f3460;text-decoration:none;font-size:14px;font-weight:500}.view-all[_ngcontent-%COMP%]:hover{color:#e94560}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.label[_ngcontent-%COMP%]{color:#666;font-size:12px;text-transform:uppercase;letter-spacing:.5px}.value[_ngcontent-%COMP%]{color:#1a1a2e;font-size:15px;font-weight:500}.sla-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:13px;font-weight:600;width:fit-content}.sla-badge.gold[_ngcontent-%COMP%]{background:gold;color:#333}.sla-badge.silver[_ngcontent-%COMP%]{background:silver;color:#333}.sla-badge.bronze[_ngcontent-%COMP%]{background:#cd7f32;color:#fff}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:13px;font-weight:600;width:fit-content}.status-badge.active[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.inactive[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.status-badge.ticket-status.open[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.ticket-status.in-progress[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.status-badge.ticket-status.resolved[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.ticket-status.closed[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.priority-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600}.priority-badge.low[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.priority-badge.medium[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.priority-badge.high[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.priority-badge.critical[_ngcontent-%COMP%]{background:#721c24;color:#fff}.tickets-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tickets-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tickets-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #eee}.tickets-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#666;font-size:12px;text-transform:uppercase;letter-spacing:.5px}.tickets-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8f9fa}.ticket-id[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-family:Monaco,Consolas,monospace;font-size:12px;color:#0f3460;text-decoration:none}.ticket-id[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.ticket-title[_ngcontent-%COMP%]{font-weight:500;color:#1a1a2e;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ticket-date[_ngcontent-%COMP%]{font-size:13px;color:#666}.no-tickets[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.stats-card[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:16px;background:#f8f9fa;border-radius:8px;margin-bottom:12px}.stats-card[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.stats-card[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#1a1a2e}.stats-card[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{color:#666;font-size:13px;margin-top:4px}@media(max-width:900px){.detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{V as CustomerDetailComponent};
