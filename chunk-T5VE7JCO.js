import{a as X}from"./chunk-I5IMH2H3.js";import{a as K}from"./chunk-ERNQUUMP.js";import{b as A,c as N,d as R,e as B,f as U,g as j,h as q,i as z,j as Y,k as G,m as H}from"./chunk-WBXUJ3X3.js";import{a as J}from"./chunk-2Q5DJ7I5.js";import{a as Q}from"./chunk-WXV2LXIK.js";import{B as C,C as S,G as p,K as s,L as o,M as n,N as T,O as v,P as M,Q as m,R as y,T as c,U as h,V as b,W as w,Y as u,Z as _,_ as x,aa as k,ea as P,ha as O,ia as I,ka as D,ma as E,o as g,oa as F,p as f,pa as V,sa as W,wa as L,y as a}from"./chunk-NZYDAHZG.js";var Z=i=>["/tickets",i];function ee(i,t){i&1&&T(0,"app-loading-spinner",4)}function te(i,t){if(i&1){let e=v();o(0,"app-alert",34),M("close",function(){g(e);let r=m(2);return f(r.errorMessage="")}),n()}if(i&2){let e=m(2);s("message",e.errorMessage)}}function ie(i,t){i&1&&(o(0,"span",35),c(1,"Title is required"),n())}function ne(i,t){i&1&&(o(0,"span",35),c(1,"Description is required"),n())}function oe(i,t){if(i&1&&(o(0,"option",36),c(1),n()),i&2){let e=t.$implicit;s("value",e.id),a(),w(" ",e.name," (",e.company,") ")}}function re(i,t){i&1&&(o(0,"span",35),c(1,"Customer is required"),n())}function ae(i,t){if(i&1&&(o(0,"option",36),c(1),n()),i&2){let e=t.$implicit;s("value",e),a(),h(e)}}function se(i,t){if(i&1&&(o(0,"option",36),c(1),n()),i&2){let e=t.$implicit;s("value",e),a(),h(e)}}function ce(i,t){if(i&1){let e=v();o(0,"div",17)(1,"label",37),c(2,"Status"),n(),o(3,"select",38),x("ngModelChange",function(r){g(e);let d=m(2);return _(d.formData.status,r)||(d.formData.status=r),f(r)}),p(4,se,2,2,"option",21),n()()}if(i&2){let e=m(2);a(3),u("ngModel",e.formData.status),a(),s("ngForOf",e.statuses)}}function de(i,t){if(i&1&&(o(0,"option",36),c(1),n()),i&2){let e=t.$implicit;s("value",e),a(),h(e)}}function me(i,t){i&1&&(o(0,"span",30),c(1," Tickets are automatically assigned to you "),n())}function le(i,t){if(i&1){let e=v();o(0,"div")(1,"header",5)(2,"a",6),c(3," \u2190 Back "),n(),o(4,"h1"),c(5),n()(),p(6,te,1,1,"app-alert",7),o(7,"div",8)(8,"form",9,0),M("ngSubmit",function(){g(e);let r=m();return f(r.onSubmit())}),o(10,"div",10)(11,"div",11)(12,"label",12),c(13,"Title *"),n(),o(14,"input",13),x("ngModelChange",function(r){g(e);let d=m();return _(d.formData.title,r)||(d.formData.title=r),f(r)}),n(),p(15,ie,2,0,"span",14),n()(),o(16,"div",10)(17,"div",11)(18,"label",15),c(19,"Description *"),n(),o(20,"textarea",16),x("ngModelChange",function(r){g(e);let d=m();return _(d.formData.description,r)||(d.formData.description=r),f(r)}),n(),p(21,ne,2,0,"span",14),n()(),o(22,"div",10)(23,"div",17)(24,"label",18),c(25,"Customer *"),n(),o(26,"select",19),x("ngModelChange",function(r){g(e);let d=m();return _(d.formData.customerId,r)||(d.formData.customerId=r),f(r)}),o(27,"option",20),c(28,"Select a customer"),n(),p(29,oe,2,3,"option",21),n(),p(30,re,2,0,"span",14),n(),o(31,"div",17)(32,"label",22),c(33,"Priority *"),n(),o(34,"select",23),x("ngModelChange",function(r){g(e);let d=m();return _(d.formData.priority,r)||(d.formData.priority=r),f(r)}),p(35,ae,2,2,"option",21),n()()(),o(36,"div",10),p(37,ce,5,2,"div",24),o(38,"div",17)(39,"label",25),c(40,"Assigned To"),n(),o(41,"select",26),x("ngModelChange",function(r){g(e);let d=m();return _(d.formData.assignedToUsername,r)||(d.formData.assignedToUsername=r),f(r)}),p(42,de,2,2,"option",21),n(),p(43,me,2,0,"span",27),n()(),o(44,"div",10)(45,"div",11)(46,"label",28),c(47,"Tags"),n(),o(48,"input",29),x("ngModelChange",function(r){g(e);let d=m();return _(d.tagsString,r)||(d.tagsString=r),f(r)}),n(),o(49,"span",30),c(50,"Separate multiple tags with commas"),n()()(),o(51,"div",31)(52,"a",32),c(53," Cancel "),n(),o(54,"button",33),c(55),n()()()()()}if(i&2){let e=m();a(2),s("routerLink",e.isEdit?k(27,Z,e.ticketId):"/tickets"),a(3),h(e.isEdit?"Edit Ticket":"Create New Ticket"),a(),s("ngIf",e.errorMessage),a(8),y("error",e.submitted&&!e.formData.title),u("ngModel",e.formData.title),a(),s("ngIf",e.submitted&&!e.formData.title),a(5),y("error",e.submitted&&!e.formData.description),u("ngModel",e.formData.description),a(),s("ngIf",e.submitted&&!e.formData.description),a(5),y("error",e.submitted&&!e.formData.customerId),u("ngModel",e.formData.customerId),a(3),s("ngForOf",e.customers),a(),s("ngIf",e.submitted&&!e.formData.customerId),a(4),u("ngModel",e.formData.priority),a(),s("ngForOf",e.priorities),a(2),s("ngIf",e.isEdit),a(4),u("ngModel",e.formData.assignedToUsername),s("disabled",!e.authService.isAdmin),a(),s("ngForOf",e.assignees),a(),s("ngIf",!e.authService.isAdmin),a(5),u("ngModel",e.tagsString),a(4),s("routerLink",e.isEdit?k(29,Z,e.ticketId):"/tickets"),a(2),s("disabled",e.saving),a(),b(" ",e.saving?"Saving...":e.isEdit?"Update Ticket":"Create Ticket"," ")}}var $=class i{constructor(t,e,l,r,d,pe){this.route=t;this.router=e;this.ticketService=l;this.customerService=r;this.authService=d;this.cdr=pe}isEdit=!1;ticketId=null;loading=!0;saving=!1;submitted=!1;errorMessage="";customers=[];assignees=[];statuses=["Open","In Progress","Resolved","Closed"];priorities=["Low","Medium","High","Critical"];formData={title:"",description:"",status:"Open",priority:"Medium",customerId:"",assignedToUsername:"",tags:[]};tagsString="";ngOnInit(){this.ticketId=this.route.snapshot.paramMap.get("id"),this.isEdit=this.ticketId!==null&&this.ticketId!=="new",this.assignees=this.authService.getAvailableAssignees(),this.formData.assignedToUsername=this.authService.currentUser?.username||"agent",this.loadCustomers()}loadCustomers(){this.customerService.getAllCustomers().subscribe({next:t=>{this.customers=t,this.isEdit&&this.ticketId?this.loadTicket(this.ticketId):(this.loading=!1,this.cdr.detectChanges())},error:t=>{console.error("Failed to load customers:",t),this.loading=!1,this.cdr.detectChanges()}})}loadTicket(t){this.ticketService.getTicketById(t).subscribe({next:e=>{e&&(this.formData={title:e.title,description:e.description,status:e.status,priority:e.priority,customerId:e.customerId,assignedToUsername:e.assignedToUsername,tags:[...e.tags]},this.tagsString=e.tags.join(", ")),this.loading=!1,this.cdr.detectChanges()},error:e=>{console.error("Failed to load ticket:",e),this.loading=!1,this.cdr.detectChanges()}})}onSubmit(){this.submitted=!0,this.errorMessage="",!(!this.formData.title||!this.formData.description||!this.formData.customerId)&&(this.formData.tags=this.tagsString.split(",").map(t=>t.trim()).filter(t=>t.length>0),this.saving=!0,this.isEdit&&this.ticketId?this.ticketService.updateTicket(this.ticketId,this.formData).subscribe({next:t=>{this.router.navigate(["/tickets",t.id])},error:t=>{this.errorMessage=t.message||"Failed to update ticket",this.saving=!1,this.cdr.detectChanges()}}):this.ticketService.createTicket(this.formData).subscribe({next:t=>{this.router.navigate(["/tickets",t.id])},error:t=>{this.errorMessage=t.message||"Failed to create ticket",this.saving=!1,this.cdr.detectChanges()}}))}static \u0275fac=function(e){return new(e||i)(C(E),C(F),C(K),C(Q),C(L),C(P))};static \u0275cmp=S({type:i,selectors:[["app-ticket-form"]],decls:3,vars:2,consts:[["ticketForm","ngForm"],["data-testid","ticket-form-page",1,"ticket-form-page"],["message","Loading...",4,"ngIf"],[4,"ngIf"],["message","Loading..."],[1,"page-header"],[1,"back-link",3,"routerLink"],["type","error",3,"message","close",4,"ngIf"],[1,"form-card"],[3,"ngSubmit"],[1,"form-row"],[1,"form-group","full-width"],["for","title"],["type","text","id","title","name","title","required","","data-testid","ticket-form-title","placeholder","Brief summary of the issue",3,"ngModelChange","ngModel"],["class","error-text",4,"ngIf"],["for","description"],["id","description","name","description","required","","rows","5","data-testid","ticket-form-description","placeholder","Detailed description of the issue...",3,"ngModelChange","ngModel"],[1,"form-group"],["for","customerId"],["id","customerId","name","customerId","required","","data-testid","ticket-form-customer",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","priority"],["id","priority","name","priority","required","","data-testid","ticket-form-priority",3,"ngModelChange","ngModel"],["class","form-group",4,"ngIf"],["for","assignedTo"],["id","assignedTo","name","assignedTo","data-testid","ticket-form-assigned",3,"ngModelChange","ngModel","disabled"],["class","help-text",4,"ngIf"],["for","tags"],["type","text","id","tags","name","tags","data-testid","ticket-form-tags","placeholder","Enter tags separated by commas (e.g., bug, urgent, login)",3,"ngModelChange","ngModel"],[1,"help-text"],[1,"form-actions"],["data-testid","ticket-form-cancel",1,"btn-secondary",3,"routerLink"],["type","submit","data-testid","ticket-form-submit",1,"btn-primary",3,"disabled"],["type","error",3,"close","message"],[1,"error-text"],[3,"value"],["for","status"],["id","status","name","status","data-testid","ticket-form-status",3,"ngModelChange","ngModel"]],template:function(e,l){e&1&&(o(0,"div",1),p(1,ee,1,0,"app-loading-spinner",2)(2,le,56,31,"div",3),n()),e&2&&(a(),s("ngIf",l.loading),a(),s("ngIf",!l.loading))},dependencies:[D,O,I,W,V,H,j,z,Y,A,q,N,R,G,U,B,J,X],styles:[".ticket-form-page[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.back-link[_ngcontent-%COMP%]{color:#666;text-decoration:none;font-size:14px;display:inline-block;margin-bottom:8px}.back-link[_ngcontent-%COMP%]:hover{color:#0f3460}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Playfair Display,Georgia,serif;font-size:28px;color:#1a1a2e;margin:0}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:32px;box-shadow:0 2px 8px #0000000f}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:6px}.form-group.full-width[_ngcontent-%COMP%]{flex:1 1 100%}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#333}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:12px 14px;border:1px solid #ddd;border-radius:8px;font-size:14px;transition:all .2s ease;font-family:inherit}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#0f3460;box-shadow:0 0 0 3px #0f34601a}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%]{border-color:#e74c3c}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled{background:#f5f5f5;cursor:not-allowed}.error-text[_ngcontent-%COMP%]{color:#e74c3c;font-size:13px}.help-text[_ngcontent-%COMP%]{color:#666;font-size:12px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px;padding-top:24px;border-top:1px solid #eee}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f3460,#16213e);color:#fff;border:none;padding:12px 24px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px #0f34604d}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#f0f0f0;color:#333;border:none;padding:12px 24px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;text-decoration:none;display:inline-block;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e0e0e0}@media(max-width:600px){.form-row[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{$ as TicketFormComponent};
