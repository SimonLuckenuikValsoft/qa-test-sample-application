import{a as Y}from"./chunk-CLZWIFWZ.js";import{a as H}from"./chunk-6QLVMUYJ.js";import{b as A,c as W,f as N,h as R,i as V,j,m as B}from"./chunk-BWQENOGP.js";import{a as U}from"./chunk-TMF6H46K.js";import{a as G}from"./chunk-4PCVNBAZ.js";import{B as k,C as S,G as p,J as x,K as c,L as i,M as e,N as T,O as P,P as g,Q as u,R as O,S as b,T as a,U as f,V as m,Y as _,Z as C,_ as h,aa as M,ea as w,ha as I,ia as E,ka as L,o as v,p as y,pa as F,sa as D,wa as z,y as s}from"./chunk-WLOU5G26.js";var J=o=>["/tickets",o],K=o=>["/tickets",o,"edit"];function Q(o,r){if(o&1&&(i(0,"option",33),a(1),e()),o&2){let n=r.$implicit;c("value",n),s(),f(n)}}function X(o,r){if(o&1&&(i(0,"option",33),a(1),e()),o&2){let n=r.$implicit;c("value",n),s(),f(n)}}function Z(o,r){o&1&&(i(0,"option",34),a(1,"Admin"),e())}function $(o,r){o&1&&(i(0,"option",35),a(1,"Agent"),e())}function tt(o,r){if(o&1&&(i(0,"option",33),a(1),e()),o&2){let n=r.$implicit;c("value",n.id),s(),m(" ",n.name," ")}}function et(o,r){o&1&&T(0,"app-loading-spinner",36),o&2&&c("overlay",!0)}function it(o,r){if(o&1&&(i(0,"span",37),a(1),e()),o&2){let n=u();s(),m(" ",n.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function nt(o,r){if(o&1&&(i(0,"span",37),a(1),e()),o&2){let n=u();s(),m(" ",n.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function ot(o,r){if(o&1&&(i(0,"span",37),a(1),e()),o&2){let n=u();s(),m(" ",n.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function rt(o,r){if(o&1&&(i(0,"span",37),a(1),e()),o&2){let n=u();s(),m(" ",n.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function at(o,r){if(o&1&&(i(0,"tr")(1,"td")(2,"div",38)(3,"span",39),a(4),e(),i(5,"span",40),a(6),e()()(),i(7,"td")(8,"span",41),a(9),e()(),i(10,"td")(11,"span",42),a(12),e()(),i(13,"td")(14,"span",43),a(15),e()(),i(16,"td")(17,"span",44),a(18),e()(),i(19,"td",45),a(20),e(),i(21,"td")(22,"div",46)(23,"a",47),a(24," View "),e(),i(25,"a",48),a(26," Edit "),e()()()()),o&2){let n=r.$implicit,t=u();x("data-testid","ticket-row-"+n.id),s(4),f(n.id),s(2),f(n.title),s(3),f(t.getCustomerName(n.customerId)),s(2),b(t.getStatusClass(n.status)),s(),m(" ",n.status," "),s(2),b(t.getPriorityClass(n.priority)),s(),m(" ",n.priority," "),s(3),f(n.assignedToUsername),s(2),m(" ",t.formatDate(n.updatedAt)," "),s(3),c("routerLink",M(16,J,n.id)),x("data-testid","view-ticket-"+n.id),s(2),c("routerLink",M(18,K,n.id)),x("data-testid","edit-ticket-"+n.id)}}function st(o,r){o&1&&(i(0,"div",49)(1,"p"),a(2,"No tickets found matching your criteria."),e()())}function lt(o,r){if(o&1){let n=P();i(0,"app-pagination",50),g("pageChange",function(d){v(n);let l=u();return y(l.onPageChange(d))}),e()}if(o&2){let n=u();c("currentPage",n.currentPage)("total",n.total)("pageSize",n.pageSize)}}var q=class o{constructor(r,n,t,d){this.ticketService=r;this.customerService=n;this.authService=t;this.cdr=d}tickets=[];customers=[];loading=!0;currentPage=1;pageSize=10;total=0;filters={search:"",status:"",priority:"",assignedTo:"all",customerId:""};sortField="updatedAt";sortDirection="desc";statuses=["Open","In Progress","Resolved","Closed"];priorities=["Low","Medium","High","Critical"];filterDebounceTimer;ngOnInit(){this.loadCustomers(),this.loadTickets()}loadCustomers(){this.customerService.getAllCustomers().subscribe({next:r=>{this.customers=r,this.cdr.detectChanges()}})}loadTickets(){this.loading=!0,this.ticketService.getTickets(this.currentPage,this.pageSize,this.filters,this.sortField,this.sortDirection).subscribe({next:r=>{this.tickets=r.tickets,this.total=r.total,this.loading=!1,this.cdr.detectChanges()},error:r=>{console.error("Failed to load tickets:",r),this.loading=!1,this.cdr.detectChanges()}})}onFilterChange(){clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=setTimeout(()=>{this.currentPage=1,this.loadTickets()},300)}clearFilters(){this.filters={search:"",status:"",priority:"",assignedTo:"all",customerId:""},this.currentPage=1,this.loadTickets()}toggleSort(r){this.sortField===r?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=r,this.sortDirection="desc"),this.loadTickets()}onPageChange(r){this.currentPage=r,this.loadTickets()}getCustomerName(r){return this.customers.find(t=>t.id===r)?.name||r}getStatusClass(r){return r.toLowerCase().replace(" ","-")}getPriorityClass(r){return r.toLowerCase()}formatDate(r){return new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(n){return new(n||o)(k(Y),k(G),k(z),k(w))};static \u0275cmp=S({type:o,selectors:[["app-ticket-list"]],decls:74,vars:20,consts:[["data-testid","ticket-list-page",1,"ticket-list-page"],[1,"page-header"],[1,"header-content"],[1,"subtitle"],["routerLink","/tickets/new","data-testid","create-ticket-button",1,"btn-primary"],["data-testid","ticket-filters",1,"filters-section"],[1,"search-box"],["type","text","placeholder","Search by title, description, or ID...","data-testid","ticket-search",1,"search-input",3,"ngModelChange","ngModel"],[1,"filter-row"],[1,"filter-group"],["data-testid","filter-status",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["data-testid","filter-priority",3,"ngModelChange","ngModel"],["data-testid","filter-assigned",3,"ngModelChange","ngModel"],["value","all"],["value","me"],["value","admin",4,"ngIf"],["value","agent",4,"ngIf"],["data-testid","filter-customer",3,"ngModelChange","ngModel"],["data-testid","clear-filters",1,"btn-secondary",3,"click"],[1,"table-section"],[1,"table-container"],[3,"overlay",4,"ngIf"],["data-testid","ticket-table",1,"tickets-table"],["data-testid","sort-title",1,"sortable",3,"click"],["class","sort-icon",4,"ngIf"],["data-testid","sort-status",1,"sortable",3,"click"],["data-testid","sort-priority",1,"sortable",3,"click"],["data-testid","sort-updated",1,"sortable",3,"click"],[4,"ngFor","ngForOf"],["class","empty-state","data-testid","no-tickets",4,"ngIf"],["testId","ticket-list-pagination",3,"currentPage","total","pageSize","pageChange",4,"ngIf"],[3,"value"],["value","admin"],["value","agent"],[3,"overlay"],[1,"sort-icon"],[1,"ticket-id-title"],[1,"ticket-id"],[1,"ticket-title"],[1,"customer-name"],[1,"status-badge"],[1,"priority-badge"],[1,"assigned-to"],[1,"date-cell"],[1,"actions"],[1,"action-link","view",3,"routerLink"],[1,"action-link","edit",3,"routerLink"],["data-testid","no-tickets",1,"empty-state"],["testId","ticket-list-pagination",3,"pageChange","currentPage","total","pageSize"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1"),a(4,"Tickets"),e(),i(5,"p",3),a(6,"Manage support tickets"),e()(),i(7,"button",4),a(8," + Create Ticket "),e()(),i(9,"section",5)(10,"div",6)(11,"input",7),h("ngModelChange",function(l){return C(t.filters.search,l)||(t.filters.search=l),l}),g("ngModelChange",function(){return t.onFilterChange()}),e()(),i(12,"div",8)(13,"div",9)(14,"label"),a(15,"Status"),e(),i(16,"select",10),h("ngModelChange",function(l){return C(t.filters.status,l)||(t.filters.status=l),l}),g("ngModelChange",function(){return t.onFilterChange()}),i(17,"option",11),a(18,"All Statuses"),e(),p(19,Q,2,2,"option",12),e()(),i(20,"div",9)(21,"label"),a(22,"Priority"),e(),i(23,"select",13),h("ngModelChange",function(l){return C(t.filters.priority,l)||(t.filters.priority=l),l}),g("ngModelChange",function(){return t.onFilterChange()}),i(24,"option",11),a(25,"All Priorities"),e(),p(26,X,2,2,"option",12),e()(),i(27,"div",9)(28,"label"),a(29,"Assigned To"),e(),i(30,"select",14),h("ngModelChange",function(l){return C(t.filters.assignedTo,l)||(t.filters.assignedTo=l),l}),g("ngModelChange",function(){return t.onFilterChange()}),i(31,"option",15),a(32,"All"),e(),i(33,"option",16),a(34,"Assigned to Me"),e(),p(35,Z,2,0,"option",17)(36,$,2,0,"option",18),e()(),i(37,"div",9)(38,"label"),a(39,"Customer"),e(),i(40,"select",19),h("ngModelChange",function(l){return C(t.filters.customerId,l)||(t.filters.customerId=l),l}),g("ngModelChange",function(){return t.onFilterChange()}),i(41,"option",11),a(42,"All Customers"),e(),p(43,tt,2,2,"option",12),e()(),i(44,"button",20),g("click",function(){return t.clearFilters()}),a(45," Clear Filters "),e()()(),i(46,"section",21)(47,"div",22),p(48,et,1,1,"app-loading-spinner",23),i(49,"table",24)(50,"thead")(51,"tr")(52,"th",25),g("click",function(){return t.toggleSort("title")}),a(53," ID / Title "),p(54,it,2,1,"span",26),e(),i(55,"th"),a(56,"Customer"),e(),i(57,"th",27),g("click",function(){return t.toggleSort("status")}),a(58," Status "),p(59,nt,2,1,"span",26),e(),i(60,"th",28),g("click",function(){return t.toggleSort("priority")}),a(61," Priority "),p(62,ot,2,1,"span",26),e(),i(63,"th"),a(64,"Assigned To"),e(),i(65,"th",29),g("click",function(){return t.toggleSort("updatedAt")}),a(66," Updated "),p(67,rt,2,1,"span",26),e(),i(68,"th"),a(69,"Actions"),e()()(),i(70,"tbody"),p(71,at,27,20,"tr",30),e()(),p(72,st,3,0,"div",31),e(),p(73,lt,1,3,"app-pagination",32),e()()),n&2&&(s(11),_("ngModel",t.filters.search),s(5),_("ngModel",t.filters.status),s(3),c("ngForOf",t.statuses),s(4),_("ngModel",t.filters.priority),s(3),c("ngForOf",t.priorities),s(4),_("ngModel",t.filters.assignedTo),s(5),c("ngIf",t.authService.isAdmin),s(),c("ngIf",t.authService.isAdmin),s(4),_("ngModel",t.filters.customerId),s(3),c("ngForOf",t.customers),s(4),O("loading",t.loading),s(),c("ngIf",t.loading),s(6),c("ngIf",t.sortField==="title"),s(5),c("ngIf",t.sortField==="status"),s(3),c("ngIf",t.sortField==="priority"),s(5),c("ngIf",t.sortField==="updatedAt"),s(4),c("ngForOf",t.tickets),s(),c("ngIf",!t.loading&&t.tickets.length===0),s(),c("ngIf",t.total>t.pageSize))},dependencies:[L,I,E,D,F,B,V,j,A,R,W,N,U,H],styles:[".ticket-list-page[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Playfair Display,Georgia,serif;font-size:32px;color:#1a1a2e;margin:0 0 8px}.subtitle[_ngcontent-%COMP%]{color:#666;font-size:15px;margin:0}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f3460,#16213e);color:#fff;border:none;padding:12px 24px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all .2s ease;text-decoration:none;display:inline-block}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 20px #0f34604d}.btn-secondary[_ngcontent-%COMP%]{background:#f0f0f0;color:#333;border:none;padding:10px 16px;border-radius:6px;font-weight:500;font-size:13px;cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e0e0e0}.filters-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 2px 8px #0000000f}.search-box[_ngcontent-%COMP%]{margin-bottom:16px}.search-input[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:all .2s ease}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#0f3460;box-shadow:0 0 0 3px #0f34601a}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-end;flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;min-width:160px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#666;text-transform:uppercase;letter-spacing:.5px}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#fff;cursor:pointer}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#0f3460}.table-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px #0000000f}.table-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.table-container.loading[_ngcontent-%COMP%]{min-height:400px}.tickets-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.tickets-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tickets-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:14px 16px;text-align:left;border-bottom:1px solid #eee}.tickets-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#666;font-size:12px;text-transform:uppercase;letter-spacing:.5px;background:#f8f9fa}.tickets-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.tickets-table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]:hover{background:#f0f0f0}.sort-icon[_ngcontent-%COMP%]{margin-left:4px}.tickets-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8f9fa}.ticket-id-title[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.ticket-id[_ngcontent-%COMP%]{font-family:Monaco,Consolas,monospace;font-size:12px;color:#666}.ticket-title[_ngcontent-%COMP%]{font-weight:500;color:#1a1a2e;max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.customer-name[_ngcontent-%COMP%]{font-size:13px;color:#333}.assigned-to[_ngcontent-%COMP%]{font-size:13px;color:#333;text-transform:capitalize}.date-cell[_ngcontent-%COMP%]{font-size:13px;color:#666;white-space:nowrap}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;white-space:nowrap}.status-badge.open[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.in-progress[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.status-badge.resolved[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.closed[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.priority-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600}.priority-badge.low[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.priority-badge.medium[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.priority-badge.high[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.priority-badge.critical[_ngcontent-%COMP%]{background:#721c24;color:#fff}.actions[_ngcontent-%COMP%]{display:flex;gap:12px}.action-link[_ngcontent-%COMP%]{font-size:13px;font-weight:500;text-decoration:none;transition:color .2s ease}.action-link.view[_ngcontent-%COMP%]{color:#0f3460}.action-link.edit[_ngcontent-%COMP%]{color:#27ae60}.action-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}"]})};export{q as TicketListComponent};
