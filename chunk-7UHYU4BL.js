import{a as q}from"./chunk-IBBY3ZPZ.js";import{a as H}from"./chunk-G7D4IJBZ.js";import{a as J}from"./chunk-EOLJ7M3P.js";import{a as Y}from"./chunk-CLZWIFWZ.js";import{b as j,c as N,f as B,m as U}from"./chunk-BWQENOGP.js";import{a as W}from"./chunk-TMF6H46K.js";import{a as G}from"./chunk-4PCVNBAZ.js";import{B as g,C as M,G as p,J as y,K as s,L as n,M as t,N as S,O as C,P as _,Q as l,R as O,S as v,T as i,U as m,V as f,Y as P,Z as T,_ as w,aa as b,ea as E,g as h,ha as I,ia as D,ka as z,ma as L,o as u,oa as A,p as x,pa as F,sa as V,wa as R,y as o}from"./chunk-WLOU5G26.js";var Q=a=>["/tickets",a,"edit"],X=a=>["/customers",a];function Z(a,r){a&1&&S(0,"app-loading-spinner",5)}function $(a,r){a&1&&(n(0,"div",6)(1,"h2"),i(2,"Ticket Not Found"),t(),n(3,"p"),i(4,"The ticket you're looking for doesn't exist or you don't have permission to view it."),t(),n(5,"a",7),i(6,"\u2190 Back to Tickets"),t()())}function ee(a,r){if(a&1){let e=C();n(0,"button",41),_("click",function(){u(e);let d=l(2);return x(d.showDeleteConfirm=!0)}),i(1," Delete Ticket "),t()}}function te(a,r){if(a&1){let e=C();n(0,"app-alert",42),_("close",function(){u(e);let d=l(2);return x(d.successMessage="")}),t()}if(a&2){let e=l(2);s("message",e.successMessage)}}function ne(a,r){if(a&1){let e=C();n(0,"app-alert",43),_("close",function(){u(e);let d=l(2);return x(d.errorMessage="")}),t()}if(a&2){let e=l(2);s("message",e.errorMessage)}}function ie(a,r){if(a&1&&(n(0,"span",47),i(1),t()),a&2){let e=r.$implicit;o(),m(e)}}function oe(a,r){if(a&1&&(n(0,"div",44)(1,"h3"),i(2,"Tags"),t(),n(3,"div",45),p(4,ie,2,1,"span",46),t()()),a&2){let e=l(2);o(4),s("ngForOf",e.ticket.tags)}}function ae(a,r){if(a&1&&(n(0,"div",48)(1,"div",49)(2,"span",50),i(3),t(),n(4,"span",51),i(5),t()(),n(6,"p",52),i(7),t()()),a&2){let e=r.$implicit,c=l(2);y("data-testid","comment-"+e.id),o(3),m(e.authorUsername),o(2),m(c.formatDate(e.createdAt)),o(2),m(e.message)}}function re(a,r){a&1&&(n(0,"div",53),i(1," No comments yet. "),t())}function ce(a,r){if(a&1&&(n(0,"span",54),i(1),t()),a&2){let e=l(2);o(),m(e.commentError)}}function se(a,r){if(a&1&&(n(0,"div",22)(1,"h2"),i(2,"Customer"),t(),n(3,"div",33)(4,"span",34),i(5,"Name"),t(),n(6,"a",55),i(7),t()(),n(8,"div",33)(9,"span",34),i(10,"Company"),t(),n(11,"span",56),i(12),t()(),n(13,"div",33)(14,"span",34),i(15,"Email"),t(),n(16,"span",57),i(17),t()(),n(18,"div",33)(19,"span",34),i(20,"SLA Level"),t(),n(21,"span",58),i(22),t()()()),a&2){let e=l(2);o(6),s("routerLink",b(7,X,e.customer.id)),o(),f(" ",e.customer.name," "),o(5),m(e.customer.company),o(5),m(e.customer.email),o(4),v(e.customer.slaLevel.toLowerCase()),o(),f(" ",e.customer.slaLevel," ")}}function de(a,r){if(a&1){let e=C();n(0,"div",8)(1,"header",9)(2,"div",10)(3,"a",11),i(4,"\u2190 Back to Tickets"),t(),n(5,"div",12)(6,"h1",13),i(7),t(),n(8,"span",14),i(9),t()()(),n(10,"div",15)(11,"a",16),i(12," Edit Ticket "),t(),p(13,ee,2,0,"button",17),t()(),p(14,te,1,1,"app-alert",18)(15,ne,1,1,"app-alert",19),n(16,"div",20)(17,"section",21)(18,"div",22)(19,"h2"),i(20,"Description"),t(),n(21,"p",23),i(22),t(),p(23,oe,5,1,"div",24),t(),n(24,"div",22)(25,"h2"),i(26),t(),n(27,"div",25),p(28,ae,8,4,"div",26)(29,re,2,0,"div",27),t(),n(30,"div",28)(31,"h3"),i(32,"Add Comment"),t(),n(33,"textarea",29),w("ngModelChange",function(d){u(e);let k=l();return T(k.newComment,d)||(k.newComment=d),x(d)}),t(),p(34,ce,2,1,"span",30),n(35,"button",31),_("click",function(){u(e);let d=l();return x(d.addComment())}),i(36),t()()()(),n(37,"aside",32)(38,"div",22)(39,"h2"),i(40,"Details"),t(),n(41,"div",33)(42,"span",34),i(43,"Status"),t(),n(44,"span",35),i(45),t()(),n(46,"div",33)(47,"span",34),i(48,"Priority"),t(),n(49,"span",36),i(50),t()(),n(51,"div",33)(52,"span",34),i(53,"Assigned To"),t(),n(54,"span",37),i(55),t()(),n(56,"div",33)(57,"span",34),i(58,"Created"),t(),n(59,"span",38),i(60),t()(),n(61,"div",33)(62,"span",34),i(63,"Updated"),t(),n(64,"span",39),i(65),t()()(),p(66,se,23,9,"div",40),t()()()}if(a&2){let e=l();o(7),m(e.ticket.title),o(2),m(e.ticket.id),o(2),s("routerLink",b(27,Q,e.ticket.id)),o(2),s("ngIf",e.authService.isAdmin),o(),s("ngIf",e.successMessage),o(),s("ngIf",e.errorMessage),o(7),f(" ",e.ticket.description," "),o(),s("ngIf",e.ticket.tags.length>0),o(3),f("Comments (",e.comments.length,")"),o(2),s("ngForOf",e.comments),o(),s("ngIf",e.comments.length===0),o(4),O("error",e.commentError),P("ngModel",e.newComment),o(),s("ngIf",e.commentError),o(),s("disabled",e.addingComment),o(),f(" ",e.addingComment?"Adding...":"Add Comment"," "),o(8),v(e.getStatusClass(e.ticket.status)),o(),f(" ",e.ticket.status," "),o(4),v(e.getPriorityClass(e.ticket.priority)),o(),f(" ",e.ticket.priority," "),o(5),m(e.ticket.assignedToUsername),o(5),m(e.formatDate(e.ticket.createdAt)),o(5),m(e.formatDate(e.ticket.updatedAt)),o(),s("ngIf",e.customer)}}var K=class a{constructor(r,e,c,d,k,le,me){this.route=r;this.router=e;this.ticketService=c;this.customerService=d;this.commentService=k;this.authService=le;this.cdr=me}ticket=null;customer=null;comments=[];loading=!0;showDeleteConfirm=!1;newComment="";commentError="";addingComment=!1;successMessage="";errorMessage="";ngOnInit(){let r=this.route.snapshot.paramMap.get("id");r&&this.loadTicket(r)}loadTicket(r){this.loading=!0,this.ticketService.getTicketById(r).subscribe({next:e=>{this.ticket=e,e?h({customer:this.customerService.getCustomerById(e.customerId),comments:this.commentService.getCommentsByTicketId(e.id)}).subscribe({next:c=>{this.customer=c.customer,this.comments=c.comments,this.loading=!1,this.cdr.detectChanges()},error:()=>{this.loading=!1,this.cdr.detectChanges()}}):(this.loading=!1,this.cdr.detectChanges())},error:e=>{console.error("Failed to load ticket:",e),this.loading=!1,this.cdr.detectChanges()}})}addComment(){if(this.commentError="",!this.newComment.trim()){this.commentError="Please enter a comment message";return}this.addingComment=!0,this.commentService.addComment(this.ticket.id,{message:this.newComment.trim()}).subscribe({next:r=>{this.comments.push(r),this.newComment="",this.addingComment=!1,this.successMessage="Comment added successfully",this.cdr.detectChanges()},error:r=>{this.commentError=r.message||"Failed to add comment",this.addingComment=!1,this.cdr.detectChanges()}})}deleteTicket(){this.showDeleteConfirm=!1,this.ticketService.deleteTicket(this.ticket.id).subscribe({next:()=>{this.router.navigate(["/tickets"])},error:r=>{this.errorMessage=r.message||"Failed to delete ticket",this.cdr.detectChanges()}})}getStatusClass(r){return r.toLowerCase().replace(" ","-")}getPriorityClass(r){return r.toLowerCase()}formatDate(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(e){return new(e||a)(g(L),g(A),g(Y),g(G),g(H),g(R),g(E))};static \u0275cmp=M({type:a,selectors:[["app-ticket-detail"]],decls:5,vars:5,consts:[["data-testid","ticket-detail-page",1,"ticket-detail-page"],["message","Loading ticket...",4,"ngIf"],["class","not-found","data-testid","ticket-not-found",4,"ngIf"],["class","ticket-content",4,"ngIf"],["title","Delete Ticket","confirmText","Delete",3,"confirm","cancel","visible","message"],["message","Loading ticket..."],["data-testid","ticket-not-found",1,"not-found"],["routerLink","/tickets",1,"btn-secondary"],[1,"ticket-content"],[1,"page-header"],[1,"header-left"],["routerLink","/tickets",1,"back-link"],[1,"title-row"],["data-testid","ticket-detail-title"],["data-testid","ticket-detail-id",1,"ticket-id"],[1,"header-actions"],["data-testid","edit-ticket-button",1,"btn-secondary",3,"routerLink"],["class","btn-danger","data-testid","delete-ticket-button",3,"click",4,"ngIf"],["type","success",3,"message","close",4,"ngIf"],["type","error",3,"message","close",4,"ngIf"],[1,"detail-grid"],[1,"main-section"],[1,"card"],["data-testid","ticket-detail-description",1,"description"],["class","tags-section",4,"ngIf"],["data-testid","comments-list",1,"comments-list"],["class","comment",4,"ngFor","ngForOf"],["class","no-comments",4,"ngIf"],["data-testid","add-comment-form",1,"add-comment"],["placeholder","Write your comment...","rows","3","data-testid","comment-input",3,"ngModelChange","ngModel"],["class","error-text",4,"ngIf"],["data-testid","submit-comment",1,"btn-primary",3,"click","disabled"],[1,"sidebar"],[1,"detail-item"],[1,"label"],["data-testid","ticket-status",1,"status-badge"],["data-testid","ticket-priority",1,"priority-badge"],["data-testid","ticket-assigned",1,"value"],["data-testid","ticket-created",1,"value"],["data-testid","ticket-updated",1,"value"],["class","card",4,"ngIf"],["data-testid","delete-ticket-button",1,"btn-danger",3,"click"],["type","success",3,"close","message"],["type","error",3,"close","message"],[1,"tags-section"],["data-testid","ticket-detail-tags",1,"tags"],["class","tag",4,"ngFor","ngForOf"],[1,"tag"],[1,"comment"],[1,"comment-header"],[1,"comment-author"],[1,"comment-date"],[1,"comment-message"],[1,"no-comments"],[1,"error-text"],["data-testid","customer-link",1,"link-value",3,"routerLink"],["data-testid","customer-company",1,"value"],["data-testid","customer-email",1,"value"],["data-testid","customer-sla",1,"sla-badge"]],template:function(e,c){e&1&&(n(0,"div",0),p(1,Z,1,0,"app-loading-spinner",1)(2,$,7,0,"div",2)(3,de,67,29,"div",3),n(4,"app-confirm-dialog",4),_("confirm",function(){return c.deleteTicket()})("cancel",function(){return c.showDeleteConfirm=!1}),t()()),e&2&&(o(),s("ngIf",c.loading),o(),s("ngIf",!c.loading&&!c.ticket),o(),s("ngIf",!c.loading&&c.ticket),o(),s("visible",c.showDeleteConfirm)("message","Are you sure you want to delete ticket "+(c.ticket==null?null:c.ticket.id)+"? This action cannot be undone."))},dependencies:[z,I,D,V,F,U,j,N,B,W,q,J],styles:[".ticket-detail-page[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.not-found[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000f}.not-found[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#1a1a2e;margin:0 0 12px}.not-found[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin:0 0 24px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}.back-link[_ngcontent-%COMP%]{color:#666;text-decoration:none;font-size:14px;display:inline-block;margin-bottom:8px}.back-link[_ngcontent-%COMP%]:hover{color:#0f3460}.title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.title-row[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Playfair Display,Georgia,serif;font-size:28px;color:#1a1a2e;margin:0}.ticket-id[_ngcontent-%COMP%]{font-family:Monaco,Consolas,monospace;font-size:14px;color:#666;background:#f0f0f0;padding:4px 12px;border-radius:20px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0f3460,#16213e);color:#fff;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #0f34604d}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#f0f0f0;color:#333;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;text-decoration:none;display:inline-block;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e0e0e0}.btn-danger[_ngcontent-%COMP%]{background:#e74c3c;color:#fff;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;transition:all .2s ease}.btn-danger[_ngcontent-%COMP%]:hover{background:#c0392b}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 340px;gap:24px}.card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #0000000f;margin-bottom:20px}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;color:#1a1a2e;margin:0 0 16px;padding-bottom:12px;border-bottom:1px solid #eee}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;color:#333;margin:16px 0 8px}.description[_ngcontent-%COMP%]{color:#333;line-height:1.7;margin:0;white-space:pre-wrap}.tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.tag[_ngcontent-%COMP%]{background:#e8f4f8;color:#0f3460;padding:4px 12px;border-radius:16px;font-size:13px}.detail-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #f0f0f0}.detail-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.label[_ngcontent-%COMP%]{color:#666;font-size:13px}.value[_ngcontent-%COMP%]{color:#333;font-size:14px;font-weight:500}.link-value[_ngcontent-%COMP%]{color:#0f3460;font-size:14px;font-weight:500;text-decoration:none}.link-value[_ngcontent-%COMP%]:hover{text-decoration:underline}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600}.status-badge.open[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.in-progress[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.status-badge.resolved[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.closed[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.priority-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600}.priority-badge.low[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.priority-badge.medium[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.priority-badge.high[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.priority-badge.critical[_ngcontent-%COMP%]{background:#721c24;color:#fff}.sla-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600}.sla-badge.gold[_ngcontent-%COMP%]{background:gold;color:#333}.sla-badge.silver[_ngcontent-%COMP%]{background:silver;color:#333}.sla-badge.bronze[_ngcontent-%COMP%]{background:#cd7f32;color:#fff}.comments-list[_ngcontent-%COMP%]{margin-bottom:24px}.comment[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:8px;padding:16px;margin-bottom:12px}.comment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.comment-author[_ngcontent-%COMP%]{font-weight:600;color:#1a1a2e;font-size:14px;text-transform:capitalize}.comment-date[_ngcontent-%COMP%]{color:#666;font-size:12px}.comment-message[_ngcontent-%COMP%]{color:#333;margin:0;line-height:1.5;font-size:14px}.no-comments[_ngcontent-%COMP%]{color:#666;font-size:14px;text-align:center;padding:20px}.add-comment[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:14px;resize:vertical;margin-bottom:12px;font-family:inherit}.add-comment[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#0f3460}.add-comment[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%]{border-color:#e74c3c}.error-text[_ngcontent-%COMP%]{color:#e74c3c;font-size:13px;display:block;margin-bottom:12px}@media(max-width:900px){.detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{K as TicketDetailComponent};
